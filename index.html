<!DOCTYPE html>
<html>
<!-- Previous head and style sections remain the same until modal styles -->
<head>
    <!-- Previous head content remains the same -->
    <style>
        /* Previous styles remain the same */
        
        /* Enhanced modal styles */
        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .delete-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .delete-button:hover {
            background: #cc0000;
        }

        .view-only-field {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Previous stats and progress bar sections remain the same -->

    <div class="kanban-board">
        <div class="column" id="inbox">
            <div class="column-header">
                üì• Inbox
                <span class="column-progress">25%</span>
            </div>
            <div class="task-list" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
        <div class="column" id="next-actions">
            <div class="column-header">
                ‚ñ∂Ô∏è Next Actions
                <span class="column-progress">50%</span>
            </div>
            <div class="task-list" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
        <div class="column" id="waiting">
            <div class="column-header">
                ‚è≥ Waiting
                <span class="column-progress">75%</span>
            </div>
            <div class="task-list" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
        <div class="column" id="completed">
            <div class="column-header">
                ‚úÖ Complete
                <span class="column-progress">100%</span>
            </div>
            <div class="task-list" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
        <div class="column" id="someday">
            <div class="column-header">
                üîÆ Someday/Maybe
                <span class="column-progress">0%</span>
            </div>
            <div class="task-list" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
    </div>

    <button class="add-task" onclick="openModal()">+</button>

    <!-- Enhanced modal for both new tasks and viewing existing tasks -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">New Task</div>
                <button class="delete-button" id="deleteButton" style="display: none" onclick="deleteTask()">Delete Task</button>
            </div>
            <div class="form-group">
                <label for="taskTitle">Task Title</label>
                <input type="text" id="taskTitle" required>
            </div>
            <div class="form-group">
                <label for="taskDescription">Description</label>
                <textarea id="taskDescription"></textarea>
            </div>
            <div class="form-group">
                <label for="taskPriority">Priority</label>
                <select id="taskPriority">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div class="form-group">
                <label for="taskDueDate">Due Date</label>
                <input type="date" id="taskDueDate">
            </div>
            <div class="form-group" id="createdAtGroup" style="display: none">
                <label>Created At</label>
                <div class="view-only-field" id="createdAt"></div>
            </div>
            <div class="form-group" id="currentProgressGroup" style="display: none">
                <label>Current Progress</label>
                <div class="view-only-field" id="currentProgress"></div>
            </div>
            <div class="modal-buttons">
                <button class="cancel-task" onclick="closeModal()">Cancel</button>
                <button class="save-task" id="saveButton" onclick="saveTask()">Save Task</button>
            </div>
        </div>
    </div>

    <script>
        // Previous variables and columnProgress object remain the same

        let currentEditingTask = null;

        function viewTask(task) {
            currentEditingTask = task;
            document.getElementById('modalTitle').textContent = 'View Task';
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description || '';
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskDueDate').value = task.dueDate || '';
            
            // Show additional fields for existing tasks
            document.getElementById('createdAtGroup').style.display = 'block';
            document.getElementById('currentProgressGroup').style.display = 'block';
            document.getElementById('deleteButton').style.display = 'block';
            document.getElementById('createdAt').textContent = new Date(task.createdAt).toLocaleString();
            
            // Find current column
            let currentColumn = '';
            Object.entries(tasks).forEach(([column, taskList]) => {
                if (taskList.find(t => t.id === task.id)) {
                    currentColumn = column;
                }
            });
            
            document.getElementById('currentProgress').textContent = `${columnProgress[currentColumn]}%`;
            
            document.getElementById('saveButton').textContent = 'Update Task';
            openModal();
        }

        function deleteTask() {
            if (!currentEditingTask) return;
            
            Object.keys(tasks).forEach(column => {
                tasks[column] = tasks[column].filter(task => task.id !== currentEditingTask.id);
            });
            
            localStorage.setItem('gtdTasks', JSON.stringify(tasks));
            renderTasks();
            closeModal();
        }

        function openModal() {
            document.getElementById('taskModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
            clearForm();
            currentEditingTask = null;
            document.getElementById('modalTitle').textContent = 'New Task';
            document.getElementById('createdAtGroup').style.display = 'none';
            document.getElementById('currentProgressGroup').style.display = 'none';
            document.getElementById('deleteButton').style.display = 'none';
            document.getElementById('saveButton').textContent = 'Save Task';
        }

        function saveTask() {
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value
            };

            if (currentEditingTask) {
                // Update existing task
                Object.keys(tasks).forEach(column => {
                    const taskIndex = tasks[column].findIndex(task => task.id === currentEditingTask.id);
                    if (taskIndex !== -1) {
                        tasks[column][taskIndex] = {
                            ...currentEditingTask,
                            ...taskData
                        };
                    }
                });
            } else {
                // Create new task
                const newTask = {
                    id: 'task-' + Date.now(),
                    createdAt: new Date().toISOString(),
                    ...taskData
                };
                tasks.inbox.unshift(newTask);
            }

            localStorage.setItem('gtdTasks', JSON.stringify(tasks));
            renderTasks();
            closeModal();
        }

        // Previous helper functions (createTaskElement, allowDrop, drag, drop) remain the same

        // Initial render
        renderTasks();
    </script>
</body>
</html>
